<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <script type="text/javascript" src='/js/utils/dom-utils.js'></script>
    <script type="text/javascript" src='/js/utils/string-math-evaluator.js'></script>
    <script type="text/javascript" src='/js/utils/custom-event.js'></script>
    <script type="text/javascript" src='/js/utils/expression-definition.js'></script>
    <script type="text/javascript" src='/js/utils/$t.js'></script>

    <script type="text/javascript">

      function parseList(str) {
        return str.split(',');
      }
      parseList.regex = /.{1,}?,.{1,}/;
      function parseValue(str) {
        return Number.parseFloat(str);
      }
      parseValue.regex = StringMathEvaluator.decimalReg;
      function parseEquation(str) {

      }
      const lineReg = /(.{1,}?)=(.*)/;
      const varReg = /[^+^-^*^/]{1,}/g;
      let startKey;
      function parseLine(line, obj) {
        const match = line.match(lineReg);
        if (match === null) return;
        const key = match[1];
        const value = match[2];
        if (startKey === undefined) startKey = key;
        if (value.match(parseList.regex)) obj[key] = parseList(value);
        else if (value.match(parseValue.regex)) obj[key] = parseValue(value);
        else {
          const sme = new StringMathEvaluator(value);
          const variables = value.match(varReg);
          obj[key] = {variables};
        }
      }

      function display(obj, startKey) {
        const value = obj[startKey];
        const choices = {};

      }
      let obj;
      window.onload = () => {
        const text = document.querySelector('#input').value;
        obj = {};
        const lines = text.split('\n');
        lines.forEach((l) => parseLine(l, obj));
        console.log(obj);
        display(obj, startKey);
      }
    </script>
    <meta charset="utf-8">
    <title>Demo eqn</title>
  </head>
  <body>
    <textarea id='input'>
    type=prefinised,normal
    prefinised=width*length*height+notched+branded
    normal=woodSpecies*width*length*heigt+notched+branded+finished
    finished=1 Top Coat,2 Top Coats
    1 Top Coat=4.50
    2 Top Coat=6.00

    woodSpecies=softMapel,birtch,walnut
    notched=2.00
    branded=4.00
    softMapel=1
    birtch=1.3
    wallnut=2.5
    </textarea>
  </body>
</html>
