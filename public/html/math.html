<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Math Practice</title>
    <style media="screen">
      .menu {
        list-style: none;
        padding: 0;
        display: inline-flex;
      }
      .menu-item {
        color: blue;
        margin: 2px;
        padding: 4px 10px;
        cursor: pointer;
        background-color: gainsboro;
        border-radius: 10pt;
      }
    </style>
    <script>
      let xexpr, consts, sign, prefix, question, answer;
      let right, wrong, mistakes;
      let type = 'Math';
      let types = {
        Sign: signGen,
        Pathag: pathag
      }

      function randInt(limit) {
        return Math.floor(Math.random() * limit);
      }

      function signGen() {
        xexpr = randInt(8) + 2;
        consts = randInt(8) + 2;
        sign = randInt(1.2);
        prefix = randInt(1.2);
        pol = randInt(2);
        answer = signAnswer();
        expr = signExpr();
        question = signExpr();
      }
      function signExpr() {
        const pre = prefix === 1 ? '' : '-';
        const s = sign == 1 ? '+' : '-';
        const p = pol == 1 ? '' : '-';
        return `${pre} (${p}${xexpr}x ${s} ${consts})`;
      }
      function signAnswer() {
        let x;
        if (sign == 1) {
          x = xexpr * -1;
        } else {
          x = xexpr;
        }
        let s =  prefix === sign ? '+' : '-';
        let p =  prefix === pol ? '' : '-';
        return `${p}${xexpr}x${s}${consts}`
      }

      function percent() {
        return Math.floor(100 * (right / ((right+wrong) || 1)));
      }

      function display() {
        document.getElementById('t').innerHTML = type + ' Practice';
        document.getElementById('q').innerHTML = question;
        document.getElementById('w').innerHTML = `${right} / ${right + wrong} - ${percent()}%`;
      }

      function toggleSubmitBtnEnable() {
        document.getElementById('b').disabled = document.getElementById('a').value === '';
      }

      function correct() {
        return answer === document.getElementById('a').value.replace(/\s/g, '').replace(/^\+/, '');
      }

      let checks = 0;
      function check() {
        const p = percent();
        const msg = 'Are you sure?';
        const hint = (right + wrong) !== 0 && (checks < (90 - p) / 10) && !correct();

        if (hint) {
          alert('Try agin');
          checks++;
        } else {
          checks = 0;
          submit();
        }
        document.getElementById('a').focus();
      }

     function submit() {
        const ans = document.getElementById('a').value.replace(/\s/g, '').replace(/^\+/, '');
        if (ans === answer) {
          right++;
          types[type]();
          mistakes = 0;
          document.getElementById('a').value = '';
        } else {
          wrong++;
          mistakes++;
        }
        display();
      }

      function change(newType) {
        if(type !== 'Math') {
          types[type].answer = answer;
          types[type].question = question;
          types[type].wrong = wrong;
          types[type].right = right;
          types[type].mistakes = mistakes;
        }
        type = newType;
        answer = types[type].answer;
        question = types[type].question;
        wrong = types[type].wrong || 0;
        right = types[type].right || 0;
        mistakes = types[type].mistakes || 0;
        if (answer === undefined) {
          types[type]();
        }
        display();
        document.getElementById('m').hidden = false;
      }

      function setup() {
        let header = '';
        Object.keys(types).forEach((type) => {
          header += `<li class='menu-item' onclick='change("${type}")'>${type}</li>`;
        });
        document.getElementById('h').innerHTML = header;
        display();
        let pathType = window.location.href.replace(/^.*?#(.*)$/, '$1');
        if(types[pathType]) change(pathType);
        document.getElementById('a').focus();
      }

      function pathag() {
        const a = randInt(9) + 1;
        const b = randInt(9) + 1;
        question = `a=${a}<br>b=${b}`;
        answer = '' + Math.round(Math.sqrt(a*a + b*b)*10) / 10;
      }
      window.onload = setup;
    </script>
  </head>
  <body>
    <ul class='menu' id='h'></ul>
    <h1 id='t'></h1>
    <div id='m' hidden>
      <h1 id='q'></h1>
      <h4 id='r'></h4>
      <h4 id='w'></h4>
      <h4 id='p'></h4>
      <input id='a' onkeyup="toggleSubmitBtnEnable()">
      <button id='b' type="button" disabled name="button" onclick="check()">Submit</button>
    </div>
  </body>
</html>
