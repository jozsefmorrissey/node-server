# Cabinet Builder

## Build And Run
- envs
  - local
  - dev
  - prod
- commands
<pre>
  node ./server.js ENV=[ENV] services=cabinet,canvas-buddy
</pre>


## Corner Stone Code Locations

### watch.js
&nbsp;&nbsp;Simple watch bundler that builds your html and js files on change.
-- kill all watchers
  <pre>kill -9 $(ps -aef | grep "watch.js" | awk '{print $2}')</pre>

### public/js/utils/utils.js
&nbsp;&nbsp;This file is used to safely add to the standard library.

### public/js/utils/dom-utils.js
&nbsp;&nbsp;Dom reading and manipulation functions.

### public/js/utils/string-math-evaluator
&nbsp;&nbsp;Has a global and a local scope used to evaluate mathmatical expressions.

### public/js/utils/$t.js
&nbsp;&nbsp;Simple html templating function. "Angularesk" {{js code}}

&nbsp;&nbsp;<b>Repeat Array</b>
<pre>      <[tag]:t repeat='[elem] in [array]'>[html]<&#47;[tag]:t></pre>

&nbsp;&nbsp;<b>Repeat Object</b>
<pre>      <[tag]:t repeat='[key], [elem] in [object]'>[html]<&#47;[tag]:t></pre>

&nbsp;&nbsp;<b>Repeat Over Indices</b>
<pre>      <[tag]:t repeat='[index] in [startIndex]..[endIndex]'>[html]<&#47;[tag]:t></pre>

&nbsp;&nbsp;<b>Repeat Defined Template</b>
<pre>      <[tag]:t [repeatExpression] $t-id='[templateLocation]'><&#47;[tag]:t></pre>

&nbsp;&nbsp;<b>Defined Template</b>
<pre>      <[tag]:t $t-id='[templateLocation]'>[scopeVariable]<&#47;[tag]:t></pre>

## GO Over
### public/js/utils/tolerance.js
&nbsp;&nbsp;Equality is hard to come by, most calculated values must be compaired using a tolerance.

### public/js/utils/tolerance-map.js
&nbsp;&nbsp;This will group objects bases on tolerance values. If you want all "matches"
to a particluar object it will return nieghboring group objects if object is not smack
dab in the center of its group/s (groups if grouped by multiple attributes).

### pulbic/js/utis/lists/expandable(-list|-object).js
&nbsp;&nbsp;Governs most list Displays. Usually expandable however this feature can be disabled.

### ~/generated/EPNTS.js
### public/js/utils/endpoints.js
### ~/public/json/endpoints.json
&nbsp;&nbsp;EPNTS.js (generated by watch/builder) uses the endpoints.js constructor passing in the endpoints.json object along with the current environment to build an endpoint object for the given environment. EPNTS.getEnv() will return the environment that it is configured for.

### ~/app-src/objects/assembly/assembly.js
&nbsp;&nbsp;defines all parts and thier sub parts.
#### Identifiers
- id() - a globally "unique" identifier
- partCode() - object type identifier
- locationCode() - location identifier
- userFriendlyId() - Cabinet specific unique indexed identifier (for display purposes)
#### Modeling Flags
- part() - model (when included) will exist in within reality
- included() - given current configuration part exists in reality
- includeJoints() - whether jointMatches are applied
#### Subassemblies
- subassemblies - list of subassmblies that must be saved
- getSubassemblies() - all decendents
- children() - direct decendents

### TODO
#### Urgent
- Sanitize html: $t.clean

#### Annoying
- HTML build changes are only applied the next time server is started.
- Parts3D display is not reflecting divider type on create (base:T is always full on creation)

### Before Release
- test cabinet width > 80 throws errors
- corner L cabinets
- 1 < openings (autoToeKick, outer corner L)

#### When I get around to it
- "Imperial (us)" does not add implicit multiplication stringMathEval
- hover help/error text
- Clean and seperate Object.(getSet|get|set);
- figure out three-view hidden lines
- ensure if new property is added existing configs updated with default value
- StringMathEvaluator: Math.atan(3/4)* (180/Math.PI) works but Math.atan(3/4)*(180/Math.PI) does not


### git commands lines modified by user
    <a href='https://stackoverflow.com/a/20414465'>Thanks Dan</a>

TODO: Create a script at some point
####All lines within cabinet service
<pre>
git log --shortstat --pretty="%cE" "./services/cabinet/*" | sed 's/\(.*\)@.*/\1/' | grep -v "^$" | awk 'BEGIN { line=""; } !/^ / { if (line=="" || !match(line, $0)) {line = $0 "," line }} /^ / { print line " # " $0; line=""}' | sort | sed -E 's/# //;s/ files? changed,//;s/([0-9]+) ([0-9]+ deletion)/\1 0 insertions\(+\), \2/;s/\(\+\)$/\(\+\), 0 deletions\(-\)/;s/insertions?\(\+\), //;s/ deletions?\(-\)//' | awk 'BEGIN {name=""; files=0; insertions=0; deletions=0;} {if ($1 != name && name != "") { print name ": " files " files changed, " insertions " insertions(+), " deletions " deletions(-), " insertions-deletions " net"; files=0; insertions=0; deletions=0; name=$1; } name=$1; files+=$2; insertions+=$3; deletions+=$4} END {print name ": " files " files changed, " insertions " insertions(+), " deletions " deletions(-), " insertions-deletions " net";}'
</pre>

####Lines that should not be counted
<pre>
git log --shortstat --pretty="%cE" "./services/cabinet/*/html-templates.js" "./services/cabinet/*/index.js" | sed 's/\(.*\)@.*/\1/' | grep -v "^$" | awk 'BEGIN { line=""; } !/^ / { if (line=="" || !match(line, $0)) {line = $0 "," line }} /^ / { print line " # " $0; line=""}' | sort | sed -E 's/# //;s/ files? changed,//;s/([0-9]+) ([0-9]+ deletion)/\1 0 insertions\(+\), \2/;s/\(\+\)$/\(\+\), 0 deletions\(-\)/;s/insertions?\(\+\), //;s/ deletions?\(-\)//' | awk 'BEGIN {name=""; files=0; insertions=0; deletions=0;} {if ($1 != name && name != "") { print name ": " files " files changed, " insertions " insertions(+), " deletions " deletions(-), " insertions-deletions " net"; files=0; insertions=0; deletions=0; name=$1; } name=$1; files+=$2; insertions+=$3; deletions+=$4} END {print name ": " files " files changed, " insertions " insertions(+), " deletions " deletions(-), " insertions-deletions " net";}'
</pre>
